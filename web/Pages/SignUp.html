<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Sign Up - Mega City Cab</title>

        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="../CSS/Styles.css">

    </head>
    <body>

        <div class="login-container">
            <div class="row h-100">

                <!--                Right Side (Full-width Form) -->
                <div class="col-md-6 d-flex flex-column justify-content-center px-12 login-section">
                    <h2 class="signupfont">Welcome to <br> Mega City Cab!</h2>


                    <form action="/Mega_City_Cab/register" onsubmit="return validatePasswords()" method="post">

                        <!-- Name -->
                        <div class="mb-2">
                            <label class="signup-form-label">Full Name:</label>
                            <input type="text" name="name" class="form-control w-75 h-25 mx-auto" required>
                        </div>

                        <!-- Email -->
                        <div class="mb-2">
                            <label class="signup-form-label">Email:</label>
                            <input type="email" name="email" class="form-control w-75 h-25 mx-auto" required>
                        </div>

                        <!-- NIC (National ID) -->
                        <div class="mb-2">
                            <label class="signup-form-label">NIC (National ID):</label>
                            <input type="text" name="nic" class="form-control w-75 h-25 mx-auto" maxlength="12" required>
                        </div>

                        <!-- Phone Number -->
                        <div class="mb-2">
                            <label class="signup-form-label">Phone Number:</label>
                            <input type="tel" name="phone" class="form-control w-75 h-25 mx-auto" maxlength="10" required>
                        </div>

                        <div class="mb-2">
                            <label class="signup-form-label">Username:</label>
                            <input type="text" name="username" id="username" class="form-control w-75 h-25 mx-auto"  required>
                            <div id="usernameWarning" class="text-danger"></div>
                        </div>

                        <!-- Password -->
                        <div class="mb-2">
                            <label class="signup-form-label">Password:</label>
                            <input type="password" name="password" id="password" class="form-control w-75 h-25 mx-auto"  required>
                            <div id="passwordWarning" class="text-danger"></div>
                        </div>

                        <!-- Confirm Password -->
                        <div class="mb-2">
                            <label class="signup-form-label">Confirm Password:</label>
                            <input type="password" name="confirm_password" id="confirm_password" class="form-control w-75 h-25 mx-auto" required>
                        </div>

                        <!-- Submit Button -->
                        <div class="d-flex justify-content-center">
                            <button class="btn submitbtn">Sign Up</button>
                        </div>
                    </form>
                    <a href="../Pages/Login.html" class="login-font">Already have an account? Login!</a>
                </div>

                <script>
                    function validatePasswords() {
                        var password = document.getElementById("password").value;
                        var confirmPassword = document.getElementById("confirm_password").value;

                        if (password !== confirmPassword) {
                            alert("Passwords do not match. Please try again.");
                            return false; // Prevent form submission
                        }
                        return true; // Allow form submission
                    }

                    // Username
                    const usernameInput = document.getElementById('username');
                    const usernameWarning = document.getElementById('usernameWarning');

                    usernameInput.addEventListener('input', () => {
                        if (usernameInput.value.length > 20) {
                            usernameInput.value = usernameInput.value.slice(0, 20);
                            usernameWarning.textContent = "Maximum 20 characters allowed!";
                        } else {
                            usernameWarning.textContent = "";
                        }
                    });

                    //username checking
                    document.getElementById('username').addEventListener('input', () => {
                        const username = document.getElementById('username').value;
                        const warning = document.getElementById('usernameWarning');

                        if (username.length > 0) {
                            fetch(`/Mega_City_Cab/checkUsername?username=${encodeURIComponent(username)}`)
                                    .then(response => response.text())
                                    .then(status => {
                                        if (status === 'taken') {
                                            warning.textContent = "Username already taken. Please choose another.";
                                            warning.classList.add('text-danger');
                                        } else if (status === 'available') {
                                            //proceed
                                        } else {
                                            warning.textContent = "Error checking username.";
                                            warning.classList.add('text-danger');
                                            warning.classList.remove('text-success');
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                        warning.textContent = "Exception checking username.";
                                        warning.classList.add('text-danger');
                                        warning.classList.remove('text-success');
                                    });
                        } else {
                            warning.textContent = "";
                        }
                    });

                    // Password
                    const passwordInput = document.getElementById('password');
                    const passwordWarning = document.getElementById('passwordWarning');

                    passwordInput.addEventListener('input', () => {
                        if (passwordInput.value.length > 20) {
                            passwordInput.value = passwordInput.value.slice(0, 20);
                            passwordWarning.textContent = "Maximum 20 characters allowed!";
                        } else {
                            passwordWarning.textContent = "";
                        }
                    });
                </script>

                <!--Left Side (Image) -->
                <div class="col-md-6">
                    <img class="loginpic" src="../Assets/Images/24hours.png" alt="Home Image">
                </div>

            </div>
        </div>

    </body>

</html>
